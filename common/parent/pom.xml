<?xml version="1.0" encoding="UTF-8"?>
<!-- vi: set et smarttab sw=2 tabstop=2: -->
<!--
 Copyright Â© 2017 Red Hat, Inc. and others. All rights reserved.

 This program and the accompanying materials are made available under the
 terms of the Eclipse Public License v1.0 which accompanies this distribution,
 and is available at http://www.eclipse.org/legal/epl-v10.html
-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>org.opendaylight.odlparent</groupId>
    <artifactId>bundle-parent</artifactId>
    <version>3.0.1</version>
    <relativePath />
  </parent>

  <groupId>org.opendaylight.infrautils</groupId>
  <artifactId>parent</artifactId>
  <version>1.3.0-SNAPSHOT</version>
    <!-- <name> formatting is used by autorelease to parse and notify projects on
        build failure. Please do not modify this unless you have a good reason. -->
  <name>ODL :: infrautils :: ${project.artifactId}</name>
  <packaging>pom</packaging>

  <properties>
    <!-- Enforce all of odlparent's optional code quality checks: -->
    <pmd.cpd.fail>true</pmd.cpd.fail>                    <!-- Fails build for copy/pasted code -->
    <duplicate-finder.skip>false</duplicate-finder.skip> <!-- Fails build if duplicate classpath entries on dependencies (odlparent 3.0.0) -->
  </properties>

  <dependencies>
    <dependency>
      <groupId>com.google.truth</groupId>
      <artifactId>truth</artifactId>
    </dependency>
    <dependency>
      <groupId>com.google.errorprone</groupId>
      <artifactId>error_prone_annotations</artifactId>
      <!-- Keep this version in line with the one of error_prone_core below -->
      <version>2.1.2</version>
    </dependency>
  </dependencies>

  <build>
    <plugins>
      <plugin>
        <groupId>org.apache.felix</groupId>
        <artifactId>maven-bundle-plugin</artifactId>
        <extensions>true</extensions>
      </plugin>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-checkstyle-plugin</artifactId>
        <configuration>
          <propertyExpansion>checkstyle.violationSeverity=error</propertyExpansion>
        </configuration>
      </plugin>
      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>findbugs-maven-plugin</artifactId>
        <configuration>
          <failOnError>true</failOnError>
        </configuration>
      </plugin>

      <plugin>
        <artifactId>maven-compiler-plugin</artifactId>
        <configuration>
          <!-- TODO showWarnings could be removed after https://git.opendaylight.org/gerrit/#/c/65150/ -->
          <showWarnings>true</showWarnings>
          <compilerId>javac-with-errorprone</compilerId>
          <forceJavacCompilerUse>true</forceJavacCompilerUse>
          <compilerArgs combine.children="append">
            <!-- TODO evaluate further which other non-default error prone bug patterns could also be enabled...
                 http://errorprone.info/bugpatterns -->
            <arg>-XepDisableWarningsInGeneratedCode</arg>
            <!-- TODO Do we need and want <arg>-Xep:OperatorPrecedence:OFF</arg> ? -->
            <!-- There are lots of disabled goodies in error-prone which only emit warnings (which nobody will ever look at!),
                 so let us enable them all as least as warnings, and then selectively turn some of them into ERROR, and suppress
                 those we really don't want (or can't enforce for whatever reason) with OFF. -->
            <arg>-XepAllDisabledChecksAsWarnings</arg>
            <!-- FieldMissingNullable is badly broken :( https://github.com/google/error-prone/issues/708 -->
            <arg>-Xep:FieldMissingNullable:OFF</arg>
            <!-- ReturnMissingNullable is badly broken :( https://github.com/google/error-prone/issues/723 -->
            <arg>-Xep:ReturnMissingNullable:OFF</arg>
            <arg>-Xep:InconsistentOverloads:ERROR</arg>
            <arg>-Xep:ConstructorLeaksThis:OFF</arg><!-- TODO <arg>-Xep:ConstructorLeaksThis:ERROR</arg> after https://github.com/google/error-prone/pull/789 for https://github.com/google/error-prone/issues/655, and maybe also https://github.com/google/error-prone/issues/809? -->
            <!-- TODO <arg>-Xep:MethodCanBeStatic:ERROR</arg> after https://github.com/immutables/immutables/issues/717 or https://github.com/google/error-prone/issues/808 -->
            <!-- TODO <arg>-Xep:ThrowsUncheckedException:ERROR</arg> after https://github.com/immutables/immutables/issues/720 -->
            <!-- TODO <arg>-Xep:TestExceptionChecker:ERROR</arg> once we've migrated from JUnit 4 to Junit 5 so we can use assertThrows - or just provide a similar testutils ourselves NOW? -->
            <!-- TODO <arg>-Xep:Var:ERROR</arg> after https://github.com/google/error-prone/issues/808 or https://github.com/immutables/immutables/issues/716  -->
            <!-- Following are things which seem useful to enforce, found in other projects;
                 we could relax these again if during enforcement all over infrautils we find them to be too strict -->
            <arg>-Xep:ConstantField:ERROR</arg>
            <arg>-Xep:EmptySetMultibindingContributions:ERROR</arg>
            <arg>-Xep:MixedArrayDimensions:ERROR</arg>
            <arg>-Xep:MultipleTopLevelClasses:ERROR</arg>
            <arg>-Xep:MultiVariableDeclaration:ERROR</arg>
            <arg>-Xep:PackageLocation:ERROR</arg>
            <arg>-Xep:PrivateConstructorForNoninstantiableModuleTest:ERROR</arg>
            <arg>-Xep:RemoveUnusedImports:ERROR</arg>
            <arg>-Xep:UnnecessaryStaticImport:ERROR</arg>
            <arg>-Xep:UseBinds:ERROR</arg>
            <arg>-Xep:WildcardImport:ERROR</arg>
          </compilerArgs>
        </configuration>
        <dependencies>
        <dependency>
          <groupId>org.codehaus.plexus</groupId>
          <artifactId>plexus-compiler-javac-errorprone</artifactId>
          <version>2.8.2</version>
        </dependency>
        <!-- Override plexus-compiler-javac-errorprone's dependency on Error Prone with the latest version -->
        <dependency>
          <groupId>com.google.errorprone</groupId>
          <artifactId>error_prone_core</artifactId>
          <!-- Keep this version in line with the one of error_prone_annotations above -->
          <version>2.1.2</version>
        </dependency>
      </dependencies>
      </plugin>
    </plugins>
  </build>
</project>
